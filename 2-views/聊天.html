<!DOCTYPE html>
<html>
<head>
  <style>html { font-size: 14px; font-family: Arial, Helvetica, sans-serif; }</style>
  <title></title>
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.common.min.css" />
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.default.min.css" />
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.mobile.all.min.css" />

  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/jquery.min.js"></script>
  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/kendo.all.min.js"></script>
    
</head>
<body>

  <style>
  </style>
  
  <div data-role="view" data-init="initData"  data-title="聊天" style="text-align: center;font-family: 'Noto Sans TC'" data-use-native-scrolling="true">
   
    <div id="聊天Div" onclick="console.log('bbb')">         
      <div>
        <ul id="messageTable"></ul>        
      </div> 
    </div>

  </div>
  
   <div style="position: absolute; bottom: 0; left:0">Send Message ...</div>
    
     
  <div data-role="modalview" id="modalview-img" style="width: 90%;">
<!--
      <header data-role="header" >
          <div data-role="navbar" style="height:30px; background:#F5404C;">
              <span style="font-size:18px;float:left; margin-top:-7px; margin-left:45%" id="aaa">圖片</span>
              <a data-click="closeModalViewLogin" data-role="button" data-align="right">Close</a>
          </div>
      </header>
-->
     <div style="background:lightgray;" onclick="closeImg()">
       <a class="k-icon k-i-close" style="font-size:20px; float:right; margin:4px"></a> 
       <img src="../%E7%B4%A2%E5%8F%96%E8%AA%B2%E7%A8%8B%E8%A1%A8.png" style="width: 100%; height:100%;" />
    </div>

    <script>
      //$("#modalview-img").kendoMobileModalView("open")
      function closeImg(){
        $("#modalview-img").kendoMobileModalView("close")
      }
    </script>
  </div>
    

  <script type="text/x-kendo-template" id="chattemplate" >
    <a class="reply km-primary km-button-right"
      style="color: white" data-role="button"
      onclick="messageBtn('#:message編號#')" 
      id = "按鈕#: message編號 #"
    >按鈕</a>

    <div style="text-align:left;">
    <img src="#: message圖片 #" width="70" height="70" style="float:left;margin-right:10px;border-radius:50%"
      onclick="messageBtn('#: message圖片 #')"
    />          
    <p style="font-size:12px; color: gray; margin-top:-4px" id ='#: message編號 #'> #: message編號 # </p>
    
    <p style="font-size:16px; color: darkslategray; text-align:left; background-color:beige; padding:5px; width:80%; border-radius:5px;" id ='msgContent#:message編號#'>#: message內容 #</p>
    
    <p style="font-size:12px; color: gray; float: left; margin-top:-8px;" id ='msgTime#: message編號#'>#: message時間 #</p>
    
    </div>

  </script>
  
  
  <script>
    //$("#toBottomChat").hide();
    
    var dataSource;
    console.log("enter 聊天.html");
        
    function initData(e) {
      console.log("initData");

      //initDataSource();
      dataSource = new kendo.data.DataSource({    
          data: [],
          schema: {
              total: function () { 
                return 77; }
          },            
          serverPaging: true,
          pageSize: 40
      });   
      
      $("#messageTable").kendoMobileListView({
          dataSource: dataSource,
          pullToRefresh: false,            
          template: $("#chattemplate").text(),        
      });

      //emptyDataSource()


      const messages = [
        { "message編號": '0001',
          "messageType": 'text',
          "message內容": 'Hello',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 10:59',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0002',
          "messageType": 'img',         
          "message內容": 'What can I help you? hdjkhdksa khjdaksljdlajsda kjdsalkdjladja kjldsldjalj',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:02',
          "message圖片":  '../dog.png',
        }, 
        { "message編號": '0003',
          "messageType": 'text',
          "message內容": 'I need to buy a car.',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 11:28',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0004',
          "messageType": 'img',         
          "message內容": 'What type of car do you wnat?',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:31',
          "message圖片":  '../dog.png',
        },   
        { "message編號": '0005',
          "messageType": 'text',
          "message內容": 'Hello',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 10:59',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0006',
          "messageType": 'img',         
          "message內容": 'What can I help you? hdjkhdksa khjdaksljdlajsda kjdsalkdjladja kjldsldjalj',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:02',
          "message圖片":  '../dog.png',
        }, 
        { "message編號": '0007',
          "messageType": 'text',
          "message內容": 'I need to buy a car.',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 11:28',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0008',
          "messageType": 'img',         
          "message內容": 'What type of car do you wnat?',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:31',
          "message圖片":  '../dog.png',
        },
        { "message編號": '0009',
          "messageType": 'text',
          "message內容": 'Hello',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 10:59',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0010',
          "messageType": 'img',         
          "message內容": 'What can I help you? hdjkhdksa khjdaksljdlajsda kjdsalkdjladja kjldsldjalj',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:02',
          "message圖片":  '../dog.png',
        }, 
        { "message編號": '0011',
          "messageType": 'text',
          "message內容": 'I need to buy a car.',
          "發送者":  'notMe',   
          "message時間": '2021/05/13 11:28',
          "message圖片":  '../btn.png',
        },
        { "message編號": '0012',
          "messageType": 'img',         
          "message內容": 'What type of car do you wnat?',
          "發送者":  'Me',   
          "message時間": '2021/05/13 11:31',
          "message圖片":  '../dog.png',
        },        
      ];      
      
      
      for (var i=0; i< messages.length; i++){
        const mesLength = messages[i].message內容.length;
        console.log(mesLength);
        
        dataSource.add(messages[i]);
        if (messages[i].發送者 == 'Me') {
          const msgId = "#msgContent"+messages[i].message編號;
          const msgTimeId = "#msgTime"+messages[i].message編號;


          $(msgId).css("text-align", "right");
          $(msgId).css("margin-left","20%");
          $(msgId).css("background", "aqua");
          $(msgTimeId).css("float","right");
          
        }
      }
      
      $("#messageTable>li").css("padding", "0px 14.837px");
         
    }
        
    function messageBtn(messageId){
      console.log("message ", messageId);
      $("#modalview-img").kendoMobileModalView("open")
    }  
  
    function emptyDataSource(){
      try {
        var numToDel = dataSource.lastRange().end;
        for (var i=0; i< numToDel; i++){
          var toDel = dataSource.at(0);
          dataSource.remove(toDel);
        }
      }catch(e){
        console.log(e);
      }
    }
    
  </script>


  <script>
      //var app = new kendo.mobile.Application(document.body, { skin: "nova" });
  </script>
</body>
</html>